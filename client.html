<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>M+++</title>
    <style>
        #titulo {
            display: flex;
            justify-content: center;
        }

        #params {
            display: flex;
        }

        .params,
        .timer, .delay, .acao {
            margin: 5px 5px;
        }

        .acao{
            display: flex;
        }

        textarea {
            width: 100%;
            height: 500px;
            font-size: 16px;
            resize: none;
        }
    </style>
</head>

<body>
    <div id="titulo">
        <h1>Escreva um código no assembly da M+++ para ser interpretado</h1>
    </div>
    <div id="input">
        <div id="codigo-area">
            <textarea type="text" id="codigo" name="codigo"></textarea>
            <div id="params">
                <div class="timer">
                    <label>Tempo máximo de execução (ss)</label>
                    <input type="number" value="60" min="10" max="1200" id="timer">
                </div>
                <div class="delay">
                    <label>Intervalo entre instruções (ss)</label>
                    <input type="number" value="0" min="0" max="1" id="delay">
                </div>
                <div class="acao">
                    <label>Selecione uma ação:</label>
                    <div>
                        <input type="radio" name="acao" id="interpretar" value="1" checked />
                        <label for="huey">Interpretar</label>
                    </div>

                    <div>
                        <input type="radio" name="acao" id="compilar" value="0" />
                        <label for="dewey">Compilar</label>
                    </div>
                </div>
            </div>
            <button id="botao">Enviar</button>
        </div>
    </div>
    <script>
        function timerValido() {
            let timer = document.getElementById("timer").value;
            let delay = document.getElementById("delay").value;
            return (timer >= 10 && timer <= 1200) && (delay >= 0 && delay <= 1);
        }
        function codigoValido() {
            return document.getElementById("codigo").value.trim().length > 0
        }
        function ajustarCodigo() {
            const allowedChars = "0123456789ABCDEFGHIJKLMNOPQRSTUVXWYZ#;,: \n";
            let codigo = document.getElementById("codigo").value.toUpperCase();
            codigo = codigo.replace(/\/\/.*/g, '').trim().split('').filter(char => allowedChars.includes(char)).join('');
            return codigo.toUpperCase();
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('botao').addEventListener('click', function () {
                var btn = document.getElementById('botao');
                try {
                    if (!timerValido() || !codigoValido()) {
                        alert("Verifique se todos os campos estão preenchidos de acordo.");
                    }
                    else {
                        btn.setAttribute('disabled', '');
                        const url = "http://SERVER_IP_AD:8080";
                        var data = {
                            code: ajustarCodigo(),
                            timer: document.getElementById("timer").value,
                            delay: document.getElementById("delay").value,
                            mode: document.querySelector('input[name="acao"]:checked').value
                        };
                        fetch(url, {
                            method: "POST",
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        }).then(response => response.text())
                            .then(data => {
                                alert(`${data}`);
                            })
                            .catch(error => {
                                alert(`Erro: ${error}`);
                            });
                    }
                } catch (error) {
                    alert(`Erro: ${error.message}`);
                }
                btn.removeAttribute('disabled', '');
            });
        });
    </script>
</body>

</html>